d5f57669d4f7331e124ae8661ba99881
"use strict";

const securityScanner = require('../services/securityScanner');
describe('Security Scanner Service', () => {
  describe('scanCode', () => {
    it('should detect hardcoded API keys', async () => {
      const code = `
const API_KEY = "sk-1234567890abcdef";
const config = {
  apiKey: "abc123def456ghi789"
};
      `;
      const result = await securityScanner.scanCode(code, 'test.js');
      expect(result.vulnerabilities).toHaveLength(2);
      expect(result.vulnerabilities[0].type).toBe('API Key');
      expect(result.riskScore).toBeGreaterThan(0);
    });
    it('should detect SQL injection patterns', async () => {
      const code = `
const query = "SELECT * FROM users WHERE id = " + userId;
const sql = \`INSERT INTO posts VALUES (\${title}, \${content})\`;
      `;
      const result = await securityScanner.scanCode(code, 'test.js');
      expect(result.vulnerabilities.length).toBeGreaterThan(0);
      expect(result.vulnerabilities.some(v => v.category === 'sqlInjection')).toBe(true);
    });
    it('should detect XSS vulnerabilities', async () => {
      const code = `
element.innerHTML = userInput;
document.write(data);
eval(userCode);
      `;
      const result = await securityScanner.scanCode(code, 'test.js');
      expect(result.vulnerabilities.length).toBeGreaterThan(0);
      expect(result.vulnerabilities.some(v => v.category === 'xss')).toBe(true);
    });
    it('should detect weak cryptography', async () => {
      const code = `
const hash = md5(password);
const sha1Hash = sha1(data);
const random = Math.random();
      `;
      const result = await securityScanner.scanCode(code, 'test.js');
      expect(result.vulnerabilities.length).toBeGreaterThan(0);
      expect(result.vulnerabilities.some(v => v.category === 'weakCrypto')).toBe(true);
    });
    it('should return no vulnerabilities for clean code', async () => {
      const code = `
const config = {
  apiKey: process.env.API_KEY
};

const query = 'SELECT * FROM users WHERE id = ?';
const stmt = db.prepare(query);
const result = stmt.get(userId);
      `;
      const result = await securityScanner.scanCode(code, 'test.js');
      expect(result.vulnerabilities).toHaveLength(0);
      expect(result.riskScore).toBeLessThanOrEqual(2);
    });
  });
  describe('generateSummary', () => {
    it('should correctly count vulnerabilities by severity', () => {
      const vulnerabilities = [{
        severity: 'HIGH',
        category: 'test'
      }, {
        severity: 'HIGH',
        category: 'test'
      }, {
        severity: 'MEDIUM',
        category: 'test'
      }, {
        severity: 'LOW',
        category: 'test'
      }];
      const summary = securityScanner.generateSummary(vulnerabilities);
      expect(summary.totalIssues).toBe(4);
      expect(summary.high).toBe(2);
      expect(summary.medium).toBe(1);
      expect(summary.low).toBe(1);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZWN1cml0eVNjYW5uZXIiLCJyZXF1aXJlIiwiZGVzY3JpYmUiLCJpdCIsImNvZGUiLCJyZXN1bHQiLCJzY2FuQ29kZSIsImV4cGVjdCIsInZ1bG5lcmFiaWxpdGllcyIsInRvSGF2ZUxlbmd0aCIsInR5cGUiLCJ0b0JlIiwicmlza1Njb3JlIiwidG9CZUdyZWF0ZXJUaGFuIiwibGVuZ3RoIiwic29tZSIsInYiLCJjYXRlZ29yeSIsInRvQmVMZXNzVGhhbk9yRXF1YWwiLCJzZXZlcml0eSIsInN1bW1hcnkiLCJnZW5lcmF0ZVN1bW1hcnkiLCJ0b3RhbElzc3VlcyIsImhpZ2giLCJtZWRpdW0iLCJsb3ciXSwic291cmNlcyI6WyJzZXJ2aWNlcy50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNlY3VyaXR5U2Nhbm5lciA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3NlY3VyaXR5U2Nhbm5lcicpO1xuXG5kZXNjcmliZSgnU2VjdXJpdHkgU2Nhbm5lciBTZXJ2aWNlJywgKCkgPT4ge1xuICBkZXNjcmliZSgnc2NhbkNvZGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgaGFyZGNvZGVkIEFQSSBrZXlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29kZSA9IGBcbmNvbnN0IEFQSV9LRVkgPSBcInNrLTEyMzQ1Njc4OTBhYmNkZWZcIjtcbmNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpS2V5OiBcImFiYzEyM2RlZjQ1NmdoaTc4OVwiXG59O1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VjdXJpdHlTY2FubmVyLnNjYW5Db2RlKGNvZGUsICd0ZXN0LmpzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudnVsbmVyYWJpbGl0aWVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnZ1bG5lcmFiaWxpdGllc1swXS50eXBlKS50b0JlKCdBUEkgS2V5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJpc2tTY29yZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgU1FMIGluamVjdGlvbiBwYXR0ZXJucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvZGUgPSBgXG5jb25zdCBxdWVyeSA9IFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCA9IFwiICsgdXNlcklkO1xuY29uc3Qgc3FsID0gXFxgSU5TRVJUIElOVE8gcG9zdHMgVkFMVUVTIChcXCR7dGl0bGV9LCBcXCR7Y29udGVudH0pXFxgO1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VjdXJpdHlTY2FubmVyLnNjYW5Db2RlKGNvZGUsICd0ZXN0LmpzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudnVsbmVyYWJpbGl0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC52dWxuZXJhYmlsaXRpZXMuc29tZSh2ID0+IHYuY2F0ZWdvcnkgPT09ICdzcWxJbmplY3Rpb24nKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IFhTUyB2dWxuZXJhYmlsaXRpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb2RlID0gYFxuZWxlbWVudC5pbm5lckhUTUwgPSB1c2VySW5wdXQ7XG5kb2N1bWVudC53cml0ZShkYXRhKTtcbmV2YWwodXNlckNvZGUpO1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VjdXJpdHlTY2FubmVyLnNjYW5Db2RlKGNvZGUsICd0ZXN0LmpzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudnVsbmVyYWJpbGl0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC52dWxuZXJhYmlsaXRpZXMuc29tZSh2ID0+IHYuY2F0ZWdvcnkgPT09ICd4c3MnKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IHdlYWsgY3J5cHRvZ3JhcGh5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29kZSA9IGBcbmNvbnN0IGhhc2ggPSBtZDUocGFzc3dvcmQpO1xuY29uc3Qgc2hhMUhhc2ggPSBzaGExKGRhdGEpO1xuY29uc3QgcmFuZG9tID0gTWF0aC5yYW5kb20oKTtcbiAgICAgIGA7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlY3VyaXR5U2Nhbm5lci5zY2FuQ29kZShjb2RlLCAndGVzdC5qcycpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnZ1bG5lcmFiaWxpdGllcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudnVsbmVyYWJpbGl0aWVzLnNvbWUodiA9PiB2LmNhdGVnb3J5ID09PSAnd2Vha0NyeXB0bycpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbm8gdnVsbmVyYWJpbGl0aWVzIGZvciBjbGVhbiBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29kZSA9IGBcbmNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5BUElfS0VZXG59O1xuXG5jb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkID0gPyc7XG5jb25zdCBzdG10ID0gZGIucHJlcGFyZShxdWVyeSk7XG5jb25zdCByZXN1bHQgPSBzdG10LmdldCh1c2VySWQpO1xuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VjdXJpdHlTY2FubmVyLnNjYW5Db2RlKGNvZGUsICd0ZXN0LmpzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudnVsbmVyYWJpbGl0aWVzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJpc2tTY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlU3VtbWFyeScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSBjb3VudCB2dWxuZXJhYmlsaXRpZXMgYnkgc2V2ZXJpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB2dWxuZXJhYmlsaXRpZXMgPSBbXG4gICAgICAgIHsgc2V2ZXJpdHk6ICdISUdIJywgY2F0ZWdvcnk6ICd0ZXN0JyB9LFxuICAgICAgICB7IHNldmVyaXR5OiAnSElHSCcsIGNhdGVnb3J5OiAndGVzdCcgfSxcbiAgICAgICAgeyBzZXZlcml0eTogJ01FRElVTScsIGNhdGVnb3J5OiAndGVzdCcgfSxcbiAgICAgICAgeyBzZXZlcml0eTogJ0xPVycsIGNhdGVnb3J5OiAndGVzdCcgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3VtbWFyeSA9IHNlY3VyaXR5U2Nhbm5lci5nZW5lcmF0ZVN1bW1hcnkodnVsbmVyYWJpbGl0aWVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN1bW1hcnkudG90YWxJc3N1ZXMpLnRvQmUoNCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5oaWdoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkubWVkaXVtKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkubG93KS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLGVBQWUsR0FBR0MsT0FBTyxDQUFDLDZCQUE2QixDQUFDO0FBRTlEQyxRQUFRLENBQUMsMEJBQTBCLEVBQUUsTUFBTTtFQUN6Q0EsUUFBUSxDQUFDLFVBQVUsRUFBRSxNQUFNO0lBQ3pCQyxFQUFFLENBQUMsa0NBQWtDLEVBQUUsWUFBWTtNQUNqRCxNQUFNQyxJQUFJLEdBQUc7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFP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