2949fba358bf456b0e76c537f3975cf4
"use strict";

const Joi = require('joi');

// File upload validation
const validateFileUpload = (req, res, next) => {
  if (!req.file) {
    return res.status(400).json({
      error: 'No file uploaded'
    });
  }
  const {
    originalname,
    size
  } = req.file;

  // Validate file size (5MB limit)
  if (size > 5 * 1024 * 1024) {
    return res.status(400).json({
      error: 'File size exceeds 5MB limit'
    });
  }

  // Validate file extension
  const allowedExtensions = ['.js', '.ts', '.py', '.java', '.cpp', '.c', '.php', '.rb', '.go', '.rs'];
  const fileExtension = originalname.toLowerCase().substring(originalname.lastIndexOf('.'));
  if (!allowedExtensions.includes(fileExtension)) {
    return res.status(400).json({
      error: 'Invalid file type. Allowed types: ' + allowedExtensions.join(', ')
    });
  }
  next();
};

// User registration validation
const validateRegistration = (req, res, next) => {
  const schema = Joi.object({
    email: Joi.string().email().required(),
    name: Joi.string().min(2).max(50).required(),
    password: Joi.string().min(6).max(100).required()
  });
  const {
    error
  } = schema.validate(req.body);
  if (error) {
    return res.status(400).json({
      error: 'Validation error',
      details: error.details.map(d => d.message)
    });
  }
  next();
};

// User login validation
const validateLogin = (req, res, next) => {
  const schema = Joi.object({
    email: Joi.string().email().required(),
    password: Joi.string().required()
  });
  const {
    error
  } = schema.validate(req.body);
  if (error) {
    return res.status(400).json({
      error: 'Validation error',
      details: error.details.map(d => d.message)
    });
  }
  next();
};

// Scan request validation
const validateScanRequest = (req, res, next) => {
  const schema = Joi.object({
    scanType: Joi.string().valid('security', 'ai-review', 'test-generation').optional(),
    options: Joi.object().optional()
  });
  const {
    error
  } = schema.validate(req.body);
  if (error) {
    return res.status(400).json({
      error: 'Validation error',
      details: error.details.map(d => d.message)
    });
  }
  next();
};

// Generic request validation
const validateRequest = schema => {
  return (req, res, next) => {
    const {
      error
    } = schema.validate(req.body);
    if (error) {
      return res.status(400).json({
        error: 'Validation error',
        details: error.details.map(d => d.message)
      });
    }
    next();
  };
};
module.exports = {
  validateFileUpload,
  validateRegistration,
  validateLogin,
  validateScanRequest,
  validateRequest
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJKb2kiLCJyZXF1aXJlIiwidmFsaWRhdGVGaWxlVXBsb2FkIiwicmVxIiwicmVzIiwibmV4dCIsImZpbGUiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJvcmlnaW5hbG5hbWUiLCJzaXplIiwiYWxsb3dlZEV4dGVuc2lvbnMiLCJmaWxlRXh0ZW5zaW9uIiwidG9Mb3dlckNhc2UiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImluY2x1ZGVzIiwiam9pbiIsInZhbGlkYXRlUmVnaXN0cmF0aW9uIiwic2NoZW1hIiwib2JqZWN0IiwiZW1haWwiLCJzdHJpbmciLCJyZXF1aXJlZCIsIm5hbWUiLCJtaW4iLCJtYXgiLCJwYXNzd29yZCIsInZhbGlkYXRlIiwiYm9keSIsImRldGFpbHMiLCJtYXAiLCJkIiwibWVzc2FnZSIsInZhbGlkYXRlTG9naW4iLCJ2YWxpZGF0ZVNjYW5SZXF1ZXN0Iiwic2NhblR5cGUiLCJ2YWxpZCIsIm9wdGlvbmFsIiwib3B0aW9ucyIsInZhbGlkYXRlUmVxdWVzdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJ2YWxpZGF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEpvaSA9IHJlcXVpcmUoJ2pvaScpO1xuXG4vLyBGaWxlIHVwbG9hZCB2YWxpZGF0aW9uXG5jb25zdCB2YWxpZGF0ZUZpbGVVcGxvYWQgPSAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgaWYgKCFyZXEuZmlsZSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTm8gZmlsZSB1cGxvYWRlZCcgfSk7XG4gIH1cbiAgXG4gIGNvbnN0IHsgb3JpZ2luYWxuYW1lLCBzaXplIH0gPSByZXEuZmlsZTtcbiAgXG4gIC8vIFZhbGlkYXRlIGZpbGUgc2l6ZSAoNU1CIGxpbWl0KVxuICBpZiAoc2l6ZSA+IDUgKiAxMDI0ICogMTAyNCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnRmlsZSBzaXplIGV4Y2VlZHMgNU1CIGxpbWl0JyB9KTtcbiAgfVxuICBcbiAgLy8gVmFsaWRhdGUgZmlsZSBleHRlbnNpb25cbiAgY29uc3QgYWxsb3dlZEV4dGVuc2lvbnMgPSBbJy5qcycsICcudHMnLCAnLnB5JywgJy5qYXZhJywgJy5jcHAnLCAnLmMnLCAnLnBocCcsICcucmInLCAnLmdvJywgJy5ycyddO1xuICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gb3JpZ2luYWxuYW1lLnRvTG93ZXJDYXNlKCkuc3Vic3RyaW5nKG9yaWdpbmFsbmFtZS5sYXN0SW5kZXhPZignLicpKTtcbiAgXG4gIGlmICghYWxsb3dlZEV4dGVuc2lvbnMuaW5jbHVkZXMoZmlsZUV4dGVuc2lvbikpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgIGVycm9yOiAnSW52YWxpZCBmaWxlIHR5cGUuIEFsbG93ZWQgdHlwZXM6ICcgKyBhbGxvd2VkRXh0ZW5zaW9ucy5qb2luKCcsICcpXG4gICAgfSk7XG4gIH1cbiAgXG4gIG5leHQoKTtcbn07XG5cbi8vIFVzZXIgcmVnaXN0cmF0aW9uIHZhbGlkYXRpb25cbmNvbnN0IHZhbGlkYXRlUmVnaXN0cmF0aW9uID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Qoe1xuICAgIGVtYWlsOiBKb2kuc3RyaW5nKCkuZW1haWwoKS5yZXF1aXJlZCgpLFxuICAgIG5hbWU6IEpvaS5zdHJpbmcoKS5taW4oMikubWF4KDUwKS5yZXF1aXJlZCgpLFxuICAgIHBhc3N3b3JkOiBKb2kuc3RyaW5nKCkubWluKDYpLm1heCgxMDApLnJlcXVpcmVkKClcbiAgfSk7XG4gIFxuICBjb25zdCB7IGVycm9yIH0gPSBzY2hlbWEudmFsaWRhdGUocmVxLmJvZHkpO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgZGV0YWlsczogZXJyb3IuZGV0YWlscy5tYXAoZCA9PiBkLm1lc3NhZ2UpXG4gICAgfSk7XG4gIH1cbiAgXG4gIG5leHQoKTtcbn07XG5cbi8vIFVzZXIgbG9naW4gdmFsaWRhdGlvblxuY29uc3QgdmFsaWRhdGVMb2dpbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBjb25zdCBzY2hlbWEgPSBKb2kub2JqZWN0KHtcbiAgICBlbWFpbDogSm9pLnN0cmluZygpLmVtYWlsKCkucmVxdWlyZWQoKSxcbiAgICBwYXNzd29yZDogSm9pLnN0cmluZygpLnJlcXVpcmVkKClcbiAgfSk7XG4gIFxuICBjb25zdCB7IGVycm9yIH0gPSBzY2hlbWEudmFsaWRhdGUocmVxLmJvZHkpO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgZGV0YWlsczogZXJyb3IuZGV0YWlscy5tYXAoZCA9PiBkLm1lc3NhZ2UpXG4gICAgfSk7XG4gIH1cbiAgXG4gIG5leHQoKTtcbn07XG5cbi8vIFNjYW4gcmVxdWVzdCB2YWxpZGF0aW9uXG5jb25zdCB2YWxpZGF0ZVNjYW5SZXF1ZXN0ID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Qoe1xuICAgIHNjYW5UeXBlOiBKb2kuc3RyaW5nKCkudmFsaWQoJ3NlY3VyaXR5JywgJ2FpLXJldmlldycsICd0ZXN0LWdlbmVyYXRpb24nKS5vcHRpb25hbCgpLFxuICAgIG9wdGlvbnM6IEpvaS5vYmplY3QoKS5vcHRpb25hbCgpXG4gIH0pO1xuICBcbiAgY29uc3QgeyBlcnJvciB9ID0gc2NoZW1hLnZhbGlkYXRlKHJlcS5ib2R5KTtcbiAgXG4gIGlmIChlcnJvcikge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLmRldGFpbHMubWFwKGQgPT4gZC5tZXNzYWdlKVxuICAgIH0pO1xuICB9XG4gIFxuICBuZXh0KCk7XG59O1xuXG4vLyBHZW5lcmljIHJlcXVlc3QgdmFsaWRhdGlvblxuY29uc3QgdmFsaWRhdGVSZXF1ZXN0ID0gKHNjaGVtYSkgPT4ge1xuICByZXR1cm4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gc2NoZW1hLnZhbGlkYXRlKHJlcS5ib2R5KTtcbiAgICBcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzLm1hcChkID0+IGQubWVzc2FnZSlcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBuZXh0KCk7XG4gIH07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgdmFsaWRhdGVGaWxlVXBsb2FkLFxuICB2YWxpZGF0ZVJlZ2lzdHJhdGlvbixcbiAgdmFsaWRhdGVMb2dpbixcbiAgdmFsaWRhdGVTY2FuUmVxdWVzdCxcbiAgdmFsaWRhdGVSZXF1ZXN0XG59O1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLEdBQUcsR0FBR0MsT0FBTyxDQUFDLEtBQUssQ0FBQzs7QUFFMUI7QUFDQSxNQUFNQyxrQkFBa0IsR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUM3QyxJQUFJLENBQUNGLEdBQUcsQ0FBQ0csSUFBSSxFQUFFO0lBQ2IsT0FBT0YsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUFFQyxLQUFLLEVBQUU7SUFBbUIsQ0FBQyxDQUFDO0VBQzVEO0VBRUEsTUFBTTtJQUFFQyxZQUFZO0lBQUVDO0VBQUssQ0FBQyxHQUFHUixHQUFHLENBQUNHLElBQUk7O0VBRXZDO0VBQ0EsSUFBSUssSUFBSSxH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